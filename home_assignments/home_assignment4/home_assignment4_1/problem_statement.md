# Практична робота 4.1

Тема - багатопотокове програмування мовою C стандарту C11. 

Терміни здачі - до 6-го квітня 2024р. включно.

Кількість балів - 20.

Для заліку роботи додайте файл `main.c` з розв'язком задачі до відповідного
завдання в Moodle.

## Умова задачі

Розробити багатопотокову програму, що для вказаного переліку текстових файлів
рахує кількість рядків в яких зустрічається вказаний фрагмент тексту.

Степінь паралелізму (кількість потоків) процедури пошуку має визначатись однією
змінною щоб можна було порівняти швидкодію програми з різними степенями.
По замовчуванню, степінь має дорівнювати 4.

Програма має використовувати функції та структури з файлу threads.h стандартної
бібліотеки мови C версії/стандарту C11.

Програма має підтримувати тільки символи з таблиці ASCII.

Пошук фрагменту має відбуватись з урахуванням регістру. Тобто пошук фрагментів
`the` та `The` має давати різний результат.

В поточній директорії вже міститься файл [main.c](./main.c) який реалізує
однопотоковий, послідовний алгоритм пошуку в файлах. Вам необхідно додати до
цього коду паралелізм.

### Формат вхідних даних

Програма має отримувати з командного рядка фрагмент тексту та перелік файлів
для пошуку в наступному форматі:

 * перший аргумент - фрагмент для пошуку;
 * всі наступні аргументи - шляхи до файлів в яких має виконуватись пошук.

Приклад виклику програми:

```
main.exe "To be, or not to be" books\pg11.txt books\pg100.txt
```

Шукає фрагмент `To be, or not to be` в двох текстових файлах за шляхами
`books\pg11.txt` та `books\pg100.txt`.

### Формат вихідних даних

Для кожного вказаного файлу, програма має вивести ім'я файлу та кількість рядків
що містять вказаний фрагмент розділені двома крапками.

Порядок файлів в виводі має співпадати з порядком файлів у вхідних даних. 

Наприклад:

```
books\pg11.txt:0
books\pg100.txt:1
```

Цей вивід означає:

 * файл `books\pg11.txt` не містить вказаного фрагменту;
 * файл `books\pg100.txt` містить один рядок в якому зустрічається вказаний
 фрагмент.

### Тестові дані

В директорії [books](./books) міститься архів
[project_gutenberg_top20.zip](./books/project_gutenberg_top20.zip) з 20-ма
найпопулярнішими творами художньої літератури з бібліотеки 
[Project Gutenberg](https://www.gutenberg.org/).

Розпакуйте цей архів в директорію `books` для виконання прикладів нижче.

### Приклад 1

#### Ввід

```
main.exe "the" books\pg100.txt books\pg11.txt books\pg1259.txt books\pg1342.txt
```

#### Вивід

```
books\pg100.txt:39633
books\pg11.txt:1581
books\pg1259.txt:12489
books\pg1342.txt:5687
```

### Приклад 2:

#### Ввід

```
"To be, or not to be" books\pg100.txt books\pg11.txt books\pg1259.txt books\pg1342.txt
```

#### Вивід

```
books\pg100.txt:1
books\pg11.txt:0
books\pg1259.txt:0
books\pg1342.txt:0
```

## Методичні вказівки

### Вимоги до персонального комп'ютера

Для виконання практичної роботи на комп'ютері від керівництвом ОС Windows, вам
необхідно встановити/оновити Visual Studio версії 17.8.4 або вище.

Для того щоб дізнатись версію встановленої Visual Studio необхідно відкрити
будь який проект та перейти до пункту меню Help -> About. В вікні що з'явиться,
має відобразитись рядок "Version 17.8.4" або новіше.

### Додаткові налаштування Visual Studio

Оскільки Visual Studio лише нещодавно отримала підтримку стандарту C11, то для
програмування з бібліотекою threads.h необхідно явно вказати стандарт мови C в
налаштування проекту.

В вікні Solution Explorer оберіть проект та відкрийте вікно Properties, оберіть
розділ General та змініть налаштування "C Language Standard" на
"ISO C11 Standard".

Файли проекту що знаходяться в поточній директорії вже містять ці налаштування.

### Робота з аргументами командного рядка в Visual Studio

Visual Studio дозволяє налагоджувати програму з вказаними аргументами командного
рядка.

Для того щоб вказати чи змінити аргументи для тестування чи налагоджування
програми, відкрийте налаштування проекту, оберіть розділ "Debugging" та
відредагуйте налаштування "Command Arguments".

Файли проекту що знаходяться в поточній директорії вже містять аргументи з
прикладу вище.

### Робота з аргументами командного рядка в мові C

Для доступу до аргументів командного рядка, в мові C використовується наступна
домовленість:

Якщо головний метод програми `main` оголошено з двома параметрами
з типами `int` та `char **` тоді перший параметр отримує від ОС загальну
кількість аргументів, а другий - масив текстових рядків що містить значення
кожного аргументу.

За домовленістю, перший аргумент (з нульовим індексом) завжди містить ім'я файлу
програми.

Приклад програми що виводить на екран всі аргументи командного рядка включно з
назвою файлу програми.

```
#include <stdio.h>

int main(int argc, char **argv)
{
    for (int i = 0; i < argc; ++i) {
        printf("%d: %s\n", i, argv[i]);
    }
    return 0;
}
```

### Документація до необхідних функцій для роботи з потоками

 * [`int thrd_create( thrd_t *thr, thrd_start_t func, void *arg );`](https://devdocs.io/c/thread/thrd_create)
 * [`int thrd_join( thrd_t thr, int *res );`](https://devdocs.io/c/thread/thrd_join)
 
## Додаткові запитання та завдання

1. Яка степінь паралелізму є найвигіднішою для запуску програми на вашому комп'ютері?
2. Як можна визначити оптимальну степінь паралелізму при старті програми?
3. У випадку коли вхідні файли суттєво відрізняються за розміром, які недоліки
поточної реалізації паралелізму? Як можна їх виправити?
4. Реалізуйте та порівняйте за швидкодією інші алгоритми пошуку фрагменту в
текстовому рядку з методом `strstr`:
    * [Алгоритм Кнута — Морріса — Пратта](https://uk.wikipedia.org/wiki/%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC_%D0%9A%D0%BD%D1%83%D1%82%D0%B0_%E2%80%94_%D0%9C%D0%BE%D1%80%D1%80%D1%96%D1%81%D0%B0_%E2%80%94_%D0%9F%D1%80%D0%B0%D1%82%D1%82%D0%B0)
    * [Алгоритм Рабіна — Карпа](https://uk.wikipedia.org/wiki/%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC_%D0%A0%D0%B0%D0%B1%D1%96%D0%BD%D0%B0_%E2%80%94_%D0%9A%D0%B0%D1%80%D0%BF%D0%B0)
    * [Алгоритм Боєра — Мура](https://uk.wikipedia.org/wiki/%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC_%D0%91%D0%BE%D1%94%D1%80%D0%B0_%E2%80%94_%D0%9C%D1%83%D1%80%D0%B0)

